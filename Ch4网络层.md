viewport:width=device-width,initial-scale=1

目录

[TOC]

##计算机网络
###Ch4网络层
网络互连:多个网络通过路由器互连成为一个互联网络

介绍网络层提供的两种不同服务->网际协议IP->网际控制报文协议ICMP和几种常用的路由选择协议,IP多播
->虚拟专用网VPN,网络地址转换NAT

传统的分类IP地址&无分类域间路由选择CIDR
路由选择协议的工作原理

####1.网络层提供的两种服务:面向连接&无连接
网络层应该向运输层提供怎样的服务
面向连接还是无连接,?

+ 面向连接的虚电路服务
+ 无连接的数据报服务

**在计算机通信中,<u>可靠交付</u>应当由谁来负责**

因特网的设计思路:
**网络层向上只提供简单灵活的,无连接的,尽最大努力交付的数据报服务**

+ 不建立连接,每一个IP分组独立发送,与其前后分组无关(不进行编号)
+ 网络层不提供服务质量承诺
	- 分组可能出错,丢失,失序

####2.网际协议IP
与IP协议配套使用的三个协议

+ 地址解析协议ARP(Address Resolution Protocol)	
+ 网际控制报文协议ICMP(Internet Control Message Protocol)
+ 网际组管理协议IGMP(Internet Group Management Protocol )

网际协议IP及其配套协议
![网际协议IP及其配套协议][0]

#####虚拟互连网络

网络互相连接遇到的问题

+ 不同的寻址方案
+ 不同的最大分组长度
+ 不同的网络接入机制
+ 不同的超时控制
+ 不同的差错恢复方法
+ 不同的状态报告方法
+ 不同的路由选择技术
+ 不同的用户接入控制
+ 不同的服务:面向连接,无连接
+ 不同的管理与控制方式


将网络互相连接起来要使用一些**中间设备**

+ 物理层使用的中间设备叫做<u>转发器repeater</u>
+ 数据链路层使用的中间设备叫做<u>网桥/桥接器</u>
+ 网络层使用的中间设备叫做<u>路由器</u>
+ 网络层以上使用的中间设备叫做<u>网关(gateway)</u>

异构网络通过路由器互连,

虚拟网络上如何寻址

#####分类的IP地址
IP地址给每个连接在因特网上的主机分配一个在全世界范围是唯一的32位标识符

$$IP地址::={<网络号>,<主机号>}$$
分类的IP地址
![分类的IP地址][1]

+ $A类,B类,C类地址的网络号字段分别为1,2,3字节;规定的数值位叫做$<u>**类别位**</u>
+ $A类,B类,C类地址的主机号字段分别为3,2,1字节$
+ D类地址用于多播(一对多通信)
+ E类地址保留

**点分十进制**
32位的IP地址,8位一组,组间加点,每组用十进制表示

常用的三类IP地址

- $A类地址$
	+ $A类地址的网络号占一个字节,只有7位可用,可指派的网络号是126=2^7-2个$
		- 为什么要减2
			+ $网络号字段全0的IP地址是保留地址,意思是$**本网络**
				- $网络号00000000_2$不可指派
			+ $网络号字段为127保留为本地软件环回测试(loopback$ $test)$本主机的进程之间通信之用
				- $网络号01111111_2$不可指派
	+ $A类地址主机号占3个字节,每一个A类网络中的最大主机数是16777214=2^{24}-2$
		- 为什么要减2
			+ $全0的主机号字段表示该IP地址是本主机所连接到的$**单个网络地址**
				- $主机号0.0.0$不可指派
				- $主机IP地址为5.6.7.8,则该主机所在的网络地址就是5.0.0.0$
			+ 全1的主机号字段表示该网络上的所有主机
				- $主机号255.255.255$不可指派
- $B类地址$
	+ $B类地址的网络号占两个字节,只有14位可用,可指派的网络号是16383=2^{14}-1个$
		- 为什么减1
			+ $网络号10000000.00000000/128.0不指派,从128.1$开始指派
	+ $B类地址主机号占两个字节,每一个B类网络中的最大主机数是65534=2^{16}-2$
		- 为什么减2
			+ 扣除主机号全0和全1的情况
- $C类地址$
	+ $C类地址的网络号占三个字节,有21位可用,可指派的网络号是2^{21}-1个$
		- 为什么减1
			+ $网络号11000000.00000000.00000000/192.0.0不指派,从192.0.1$开始指派
	+ $C类地址主机号占一个字节,每一个C类网络中的最大主机数是254=2^8-2$
		- 为什么减2
			+ 扣除主机号全0和全1的情况

总结两点

+ **网络号,可用字段为全0的都不分派**,
所以A,B,C每一类网络号数目减一
	- 网络号可用位全0表示本网络
	- 网络号为127的IP地址保留为本地环回地址,
	所以A类网络号数目再减一
+ **主机号,字段全0和全1都不分派**
所以,A,B,C每一类主机号数目减2
	- 字段全0用于表示网络地址
	- 字段全1用于表示所有主机

$IP128.7.255.255::={<128.7>,<255.255>},主机号为全1,表示网络128.7.0.0上的所有主机$
$IP0.0.0.35::={<0>,<0.0.35>}网络号可用位全0,表示这个网络上主机号位35的主机$

IP地址重要特点

+ IP地址由网络号和主机号两部分组成,是一种分等级的地址机构
	- IP地址管理机构只分配网络号
	- 路由器仅根据目的主机的网络号转发分组
	减小了路由表所占的存储空间及路由表查找时间
+ IP地址实际上标志一个主机和一条链路的接口
	- 当一个主机同时连接到两个网络上时,各自都要一个IP地址来标志.多归属主机
	比如路由器	
+ 一个网络是指具有相同网路号net-id的主机的集合
	- 因此用转发器/网桥连接起来的若干个局域网仍是一个网络
+ 所有分配到网路号的网络是平等地

**当两个路由器直连时**在连接线的两端的接口处,可以分配也可以不分配IP地址

+ 分配了IP地址,这一段连线就构成了一种只包含一段线路的特殊网络
+ 不分配也可以,无编号网络/无名网络

#####IP地址与硬件地址

在网络层,IP数据报的目的地址和源地址始终不变
在数据链路层,MAC帧在不同网络上传送时首部中的目的地址和源地址要发生变化

#####地址解析协议ARP
ARP:已知IP地址,找到相应的硬件地址
从网络层使用的IP地址解析出数据链路层使用的硬件地址

**由于传送ARP分组使用的是IP协议,**所以ARP协议属于网络层

(RARP的功能包含在了DHCP中)

ARP协议的要点

在主机的ARP高数缓存中存放一个从IP地址到硬件地址的映射表.
(映射表经常动态更新)

主机A向主机B发送IP数据报时,如果主机A的ARP高速缓存中没有主机B的数据
主机A自动运行ARP

+ ARP进程在本局域网上广播发送一个ARP请求分组
	- 内容是:我的IP地址,硬件地址,想知道的硬件地址对应的IP地址
+ 本局域网上的所有主机运行的ARP进程收到了此ARP请求方分组
+ 主机B的IP地址与ARP请求查询的一致,收下了此分组,开始响应
+ 主机A收到主机B的ARP响应分组后,在自己的ARP高速缓存张写入数据	

如果没有ARP高速缓存,主机每一次通信都要通过广播方式获得硬件地址,无疑很低效

ARP为映射地址项目都设置一个生存时间

ARP解析解决一个局域网内IP地址到硬件地址的映射问题

从IP地址到硬件地址的解析式自动进行的,主机用户对地址解析过程是不知道的

使用ARP的四种典型情况

+ 局域网内一个主机H1发往同一个局域网内另一个主机H2
+ 主机H1发往另一个局域网H2
+ 路由器发送到局域网内的一个主机
+ 路由器发送到另一个局域网内的一个主机

(为什么不直接使用硬件地址,?)
#####IP数据报的格式
[0]:http://cjhgo.sinaapp.com/CS/ComputerNetwork/images/internetlayer.gif
[1]:http://cjhgo.sinaapp.com/CS/ComputerNetwork/images/ipclass.gif
