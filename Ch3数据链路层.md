viewport:width=device-width,initial-scale=1

目录

[TOC]

##计算机网络
###Ch3数据链路层

分组怎样从一个主机不经过路由器传送到另一个主机

使用的信道有以下两种基本类型

+ 点对点信道:使用一对一的点对点通信方式
	- PPP协议Point-to-Point Protocol 点对点协议
+ 广播信道:使用一对多的广播通信方式
	- 广播信道上连接的主机很多,必须使用专用的共享信道协议来协调这些主机的数据发送
	CSMA/CD协议Carrier Sense Multiple Access with Collision Detection 载波监听多点介入/碰撞检测协议

主要内容

+ 点对点信道和广播信道的特点,
这两种信道使用的协议的特点
+ 数据链路层的3个基本问题
	- 封装成帧
	- 透明传输
	- 差错检测
+ 以太网MAC层的硬件地址
+ 适配器,转发器,集线器,网桥,以太网交换机的作用以及使用场合	


####3.1使用点对点信道的数据链路层
#####数据链路和帧
数据链路

点对点信道的数据链路层进行通信的主要步骤

+ 发送方A把网络层交下来的IP数据报添加**首部和尾部**<u>封装成帧</u>
+ A把封装好的帧发送给接收方B 
+ 若结点B的数据链路层收到的帧无差错,则从收到的帧中提取IP数据报上交给上面的网络层
否则丢弃这个帧
#####三个基本问题
1. 封装成帧:IP数据报前后分别添加首部和尾部构成了帧
接收端在收到物理层上交的比特流后,根据首部和尾部的标记从收到的比特流中识别帧的开始和结束
	- 首部和尾部的一个重要作用就是进行**帧定界**
	- 每一种链路层协议都规定了所能传送的帧的数据部分的长度上限<u>最大传送单元</u>
		+ MTU,Maximum Transfer Unit
	- 当数据是由可打印的ASCII码组成时,帧定界可以使用特殊的帧定界符
		+ SOH,start of  header,01H
		+ ENT,end of tranmission,04H		
2. 透明传输:无论什么样的比特组合的数据都能够通过数据链路层
当数据部分是非ASCII码的文本文件时,可能和帧定界符发生冲突,使得帧被错误的定界,引起数据传输错误
采取的解决措施
	- **字节填充/字符填充**:转义字符'ESC',1BH
3. (比特)差错检测:
比特差错:1变成了0,0变成了1...
在数据链路层广泛使用了循环冗余检验的检错技术(也可以采取其他技术)
	- 循环冗余检验原理
	......
	- 仅仅使用循环冗余检验,只能做到对帧的无差错接受

**凡是接收端数据链路层接受的帧均无差错**

传输差错可以分为两大类

+ 基本的比特差错
+ 帧没有出现比特差错,出现了
	- 帧丢失
	- 帧重复
	- 帧失序
	这些差错都是CRC解决不了的

所以,**在数据链路层使用CRC检验,能够实现无比特差错的传输,但这并不是可靠传输**	
	- 可靠传输要求发送端发送什么,接收端就收到什么

+ 对于通信质量好的有线传输链路,不适用确认和重传机制,不要求数据链路层向上提供可靠传输服务
+ 对于通信质量差的无线传输链路,使用确认和重传机制,向上提供可靠传输服务

在通信路线质量差的年代,数据链路层使用可靠传输协议HDLC高级数据链路控制协议
####3.2点对点协议PPP
PPP:用户计算机和ISP进行通信时所使用的数据链路层协议
#####PPP协议的特点

1. 应满足的需求
	+ 简单
	+ 封装成帧
	+ 透明性
	+ 多种网络层协议:在同一条物理链路上同时支持多种网络层协议(IP/IPX)
	+ 多种类型链路:能在多种类型的链路上运行(串行的,并行的,同步的,异步的,光的,点的...)
		- 一个适应多种类型链路的典型例子PPPoE(over Ethernet)
	+ 差错检测
	+ 检测连接状态
	+ 最大传送单元MTU默认值:1500字节
		- MTU只是数据部分的最大长度,帧的长度还要算上头部尾部
	+ 网络层地址协商
	+ 数据压缩协商
PPP协议只支持全双工链路
2. 协议的组成
	+ IP数据报封装的方法
	+ 用来建立,配置,测试数据链路连接的链路控制协议LCP(link control protocol)
	+ 一套网络控制协议NCT(network control protocol)	
#####PPP协议的帧格式
![PPP帧的格式][0]

1. 各字段的意义
	+ 首部的第一个字段和尾部的第二个字段都是标志字段F(flag),就是帧的定界符
		- 连续两帧之间共用一个定界符;如果出现连续的两个标志字段,表示是空帧,应丢弃
	+ A,C字段固定...
	+ 首部的第四个字段是2字节的协议字段
		- 0x0021:表示信息部分是IP数据报
		- 0xC021:表示信息部分是LCP的数据
		- 0x8021:表示信息部分是网络控制数据
	+ 尾部的第一个字段,2个字节,是使用CRC的帧检验序列FCS
	+ 信息字段长度可变,不超过**1500**字节
2. 字节填充(PPP使用异步传输)
转义符定为0x7D
信息字段中
	+ 出现定界符0x7E时,转变成2字节序列(7D5EH)
	+ 出现转义符号0x7D时,转变为2字节序列(7D5DH)
	+ 出现ASCII码的控制字符时,前面加一个0x7D
3. 零比特填充(PPP使用同步传输)
	+ 发送端扫描整个信息字段,只要发现5个连续1,就填入1个0
	+ 接收端反向处理
#####PPP协议的工作状态
一开始是怎样被初始化的,?
![PPP状态转换][1]
PPP链路的起始和终止状态永远是链路静止状态,这时用户PC和ISP的路由器之间不存在物理层的连接

1. 建立物理层的连接,进入<u>链路建立</u>状态
2. LCP开始协商一些配置选项,发送LCP的配置请求帧(configure-request)
(对应前边帧的格式中首部第四个字段设为0xC021)
配置以下一些内容
	+ 最大帧长
	+ 所用的鉴别协议,不适用PPP帧中首部的那两个没意义的字段
	+ 另一端可以发送一下几种 响应
		- 配置确认帧:所有选型接受
		- 配置否认帧:所有选型理解但不能接受
		- 配置拒绝帧:选型有的无法识别或不能接受,需要协商
	+ 根据协商的结果,
		- 协商失败则回到了链路静止状态
3. 协商成功后建立了LCP链路,进入<u>鉴别</u>状态
4. 鉴别成功进入网络协议状态
5. 网络层配置完毕后,<u>链路打开</u>

根据上述流程,PPP协议已不是纯粹的数据链路层协议,还包含了物理层和网络层的内容
####3.3使用广播信道的数据链路层
#####局域网的数据链路层
局域网的工作层次跨越了数据链路层和物理层

局域网按网络拓扑分类

+ 星形网
+ 环形网
+ 总线网

共享信道如何使众多用户合理方便的共享通信媒体资源

+ 静态划分信道:FDM,TDM,WDM,CDM:用户只要分配了信道就不会和其他用户发生冲突
+ 动态媒体介入控制/多点介入multipleaccess:信道并非在用户通信时固定分配给用户
	- **随机接入**:所有用户可随机发送信息
		+ 如果恰有两个或更多用户在同一时刻发送信息,那么在共享媒体上就发生了碰撞
		因此必须有解决碰撞的协议
	- **受控接入**:用户发送信息服从一定的控制
		+ 代表分散控制的令牌环局域网
		+ 集中控制的多点线路探询/轮询

**传统以太网**		

1. 历史:以太网的两个标准,逻辑链路控制LLC,媒体接入控制MAC
2. 适配器的作用:计算机通过适配器和局域网进行通信
适配器上面装有处理器和存储器
适配器接收和发送各种帧时不适用计算机的CPU
计算机的硬件地址就在适配器的ROM中
#####CSMA/CD协议
总线的特点是当一台计算机发送数据时,总线上的所有计算机都能检测到这个数据,这也是所谓的广播通信
但是我们可能需要一对一而不是一对多通信
所以如何在总线上实现一对一通信,?根据MAC地址
以太网

+ 采用无连接的工作方式,:不必建立连接直接发送数据,发送的数据不编号不要求确认
**提供的服务是尽最大努力交付,即不可靠交付**
差错帧是否重传由上层决定,(重传的帧以太网并不知道是重传的...)
以太网采用最简单的随机接入
**在同一时间内只能允许一台计算机发送数据**
	- 协调方法:<u>载波监听多点接入/碰撞检测协议</u>
+ **以太网发送的数据都使用<u>曼彻斯特编码</u>的信号**

######CSMA/CD协议的要点
+ 多点接入:说明是总线型网络,许多计算机以多点接入的方式连接在一根总线上
+ 载波监听(检测信道):用电子技术检测总线上有没有其他计算机也在发送.
不管是在发送前还是发送中,每个站都必须不停的检测信道
	- 发送前检测是为了获得发送权
	- 发送中检测是为了及时发现碰撞
+ 碰撞检测(边发送边监听)
适配器在发送一帧数据期间监听信道

- <u>为什么发生碰撞就无法继续发送帧,?</u>

	+ 首先,什么是发生碰撞,?
		- 总线上至少两个数据信号在传递
	+ 发生碰撞总线上的信号就会失真,无法从中恢复有用的信息
	这样的信号对哪个站都是没用的,因为找不回发给自己的信息了
	+ 所以,发生碰撞的信号是无用信号

由以上,任何时刻总线上只能有一个信号在发送,那么显然,
**使用CSMA/CD协议的以太网只能进行半双工通信**
一个站不可能同时进行发送和接收
(发送的信号和接收的信号在总线上叠加在一起就成了失真信号)

- <u>为什么一个站在发送数据之前已经通过监听得知信道为空闲,还是会出现数据在总线上碰撞呢,?</u>
因为数据的载体电磁波在总线是以有限的速率传播的
A站检测到信道是空闲的,发送数据
此时B站同样检测到信道是空闲的,也发送数据
数据在同一条总线上传播,必然碰撞,此次发送数据就宣告无效

- <u>一个站发送数据之后,最迟要经过多长时间才能知道自己发送的数据和其他站发送的数据没有碰撞,?</u>
**这个时间是两倍的总线端到端传播时延(2$\tau$)**或总线的端到端往返传播时延
	+ $\tau$叫做单程端到端传播时延;端到端往返传播时延取其二倍
	+ 最迟:A检测到碰撞发生最长要经历多少时间,?
	+ <u>是否发生碰撞</u>
		- A发生的数据从离开A到到达目的地的这段时间内是否碰上其他信号
		B站发送的信号要想与A站发送的信号产生碰撞,
	+ <u>什么时候检测到碰撞</u>
		- 和A发送的数据信号发生碰撞的数据信号传播到A站的位置的时候

最坏的情况是总线两端的两个站之间的传播时延,局域网必须按照最坏的情况设计
	
传播时延对载波监听的影响
![CSMA/CD的一些重要时刻][2]




[0]:http://cjhgo.sinaapp.com/CS/ComputerNetwork/images/PPP_frame.gif
[1]:http://cjhgo.sinaapp.com/CS/ComputerNetwork/images/PPP_status.gif
[2]:http://cjhgo.sinaapp.com/CS/ComputerNetwork/images/CSMACD_event.gif
